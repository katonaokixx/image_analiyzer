{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}管理者用画像一覧 - 画像解析アプリ{% endblock %}

{% block navbar %}
{% include 'includes/admin_navbar.html' %}
{% endblock %}

{% block content %}
{% csrf_token %}

<div class="pt-16 py-8 sm:py-16 lg:py-24">
  <div class="container mx-auto px-2 py-0">
    <div class="bg-base-100 py-4 sm:py-8 lg:py-12">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="mb-6 space-y-3 text-center sm:mb-8 lg:mb-12">
          <h2 class="text-base-content text-2xl font-semibold md:text-3xl lg:text-4xl">
            <span class="relative z-1 font-bold">
              管理者用
              <span
                class="from-primary absolute start-0 bottom-1 -z-1 h-0.5 w-full bg-gradient-to-r to-transparent to-80%"
                aria-hidden="true"></span>
            </span>
            画像一覧ページ
          </h2>
          <p class="text-base-content/80 text-xl">
            全ユーザーの画像解析状況を管理できます。アップロードされた画像の一覧、解析進捗、結果を確認できます。
          </p>
          <div class="group flex items-center justify-center gap-2 pt-2 pb-2"
            style="padding-top: 8px !important; padding-bottom: 8px !important;">
            <a href="{% url 'v2_logout' %}" class="link link-animated link-primary font-normal">ログアウト</a>
            <span
              class="icon-[tabler--chevron-right] text-primary size-5 shrink-0 transition-transform group-hover:translate-x-1 rtl:rotate-180"></span>
          </div>
        </div>
      </div>
    </div>
  </div>


</div>
<!-- テーブルセクション -->
<div class="container mx-auto px-4 py-4">
  <div class="bg-base-100 rounded-xl shadow-sm p-6">
    <!-- Filter Bar -->
    <div class="flex flex-col flex-wrap gap-4 sm:flex-row sm:items-center sm:justify-between mb-6">
      <!-- Left side: Search -->
      <div class="select-floating w-80">
        <input class="input" list="datalistOptions" id="exampleDataList" placeholder="ファイル名で検索..." />
        <label class="select-floating-label" for="selectFloating">検索</label>
      </div>
      <!-- Right side: Date Sort and Status Filter -->
      <div class="flex flex-col sm:flex-row gap-4">
        <div class="select-floating w-40">
          <select class="select" aria-label="Date sort" id="dateSort">
            <option>新しい順</option>
            <option>古い順</option>
          </select>
          <label class="select-floating-label" for="dateSort">日順ソート</label>
        </div>

        <div class="select-floating w-40">
          <select class="select" aria-label="Select floating label" id="selectFloating">
            <option>すべて</option>
            <option>アップロード完了</option>
            <option>解析成功</option>
            <option>解析中</option>
            <option>準備中</option>
            <option>失敗</option>
          </select>
          <label class="select-floating-label" for="selectFloating">ステータス</label>
        </div>

        <div class="select-floating w-40">
          <select class="select" aria-label="User filter" id="userFilter">
            <option>すべて</option>
            {% for user in users %}
            <option>{{ user.username }}</option>
            {% endfor %}
          </select>
          <label class="select-floating-label" for="userFilter">ユーザー名</label>
        </div>



        <div class="select-floating w-40">
          <select class="select" aria-label="Model filter" id="modelFilter">
            <option>すべて</option>
            <option>PyTorch ResNet-50</option>
            <option>PyTorch VGG-16</option>
            <option>PyTorch MobileNet</option>
            <option>CLIP</option>
          </select>
          <label class="select-floating-label" for="modelFilter">使用モデル</label>
        </div>

        <div class="select-floating w-40">
          <select class="select" aria-label="Label filter" id="labelFilter">
            <option>すべて</option>
            <option>人物</option>
            <option>アニメ・イラスト</option>
            <option>動物</option>
            <option>テクノロジー</option>
            <option>ファッション</option>
            <option>食べ物</option>
            <option>建物</option>
            <option>乗り物</option>
            <option>自然</option>
            <option>スポーツ</option>
          </select>
          <label class="select-floating-label" for="labelFilter">ラベル</label>
        </div>

        <div class="select-floating w-40">
          <select class="select" aria-label="Confidence filter" id="confidenceFilter">
            <option>すべて</option>
            <option>90%以上</option>
            <option>80-89%</option>
            <option>70-79%</option>
            <option>60-69%</option>
            <option>60%未満</option>
          </select>
          <label class="select-floating-label" for="confidenceFilter">信頼度</label>
        </div>

        <button type="button" class="btn btn-soft btn-sm btn-circle" onclick="resetAllFilters()" title="フィルターをリセット">
          <span class="icon-[tabler--refresh] size-4"></span>
        </button>
      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto max-w-6xl mx-auto">
      <!-- Debug: has_data = {{ has_data }} -->
      {% if has_data %}
      <table class="table w-full [&_tr:nth-child(even)]:bg-base-200">
        <thead>
          <tr>
            <th>ユーザー名</th>
            <th>サムネイル画像</th>
            <th>アップロード日時</th>
            <th>ステータス</th>
            <th>機械学習によってつけられたラベル</th>
            <th>信頼度</th>
            <th>エラーログ</th>
            <th>解析開始日時</th>
            <th>解析終了日時</th>
            <th>使用した学習モデル</th>
          </tr>
        </thead>
        <tbody>
          {% for image in images %}
          <tr data-image-id="{{ image.id }}">
            <td>
              <span class="font-medium text-red-500">{{ image.user_id.username }}</span>
            </td>
            <td>
              <div class="flex items-center gap-3">
                <div class="avatar cursor-pointer" data-overlay="#slide-down-animated-modal">
                  <div class="bg-base-content/10 h-10 w-10 rounded-md">
                    <div class="image-placeholder-small" data-src="{{ image.thumbnail_url }}">
                      <div class="skeleton h-full w-full animate-pulse"></div>
                    </div>
                  </div>
                </div>
                <div>
                  <div class="text-sm opacity-50">画像ファイル</div>
                  <div class="font-medium">{{ image.simple_filename }}</div>
                </div>
              </div>
            </td>
            <td>
              {% if image.upload_completed_at %}
              {{ image.upload_completed_at|date:"Y-m-d H:i" }}
              {% else %}
              {{ image.created_at|date:"Y-m-d H:i" }}
              {% endif %}
            </td>
            <td>
              {% if image.status == 'completed' %}
              <span class="badge badge-outline border-dashed badge-success me-2 cursor-pointer" title="クリックしてタイムラインを確認"
                data-overlay="#timeline-modal">解析成功</span>
              {% elif image.status == 'uploaded' %}
              <span class="badge badge-outline border-dashed badge-warning me-2 cursor-pointer"
                title="クリックしてアップロードページに遷移" onclick="navigateToUploadPage({{ image.id }}, 'uploaded')">アップロード完了</span>
              {% elif image.status == 'analyzing' %}
              <span class="badge badge-outline border-dashed badge-info me-2 cursor-pointer" title="クリックしてタイムラインを確認"
                data-overlay="#timeline-modal">解析中</span>
              {% elif image.status == 'preparing' %}
              {% if image.queue_item %}
              <span class="badge badge-outline border-dashed badge-secondary me-2 cursor-pointer"
                title="クリックしてタイムラインを確認" data-overlay="#timeline-modal">
                準備中 → あと{{ image.queue_item.waiting_position }}枚
              </span>
              {% else %}
              <span class="badge badge-outline border-dashed badge-secondary me-2 cursor-pointer"
                title="クリックしてタイムラインを確認" data-overlay="#timeline-modal">準備中</span>
              {% endif %}
              {% elif image.status == 'failed' %}
              <span class="badge badge-outline border-dashed badge-error me-2 cursor-pointer" title="クリックしてタイムラインを確認"
                data-overlay="#timeline-modal">失敗</span>
              {% else %}
              <span class="badge badge-outline border-dashed badge-secondary me-2">
                準備中
              </span>
              {% endif %}
            </td>
            <td class="text-center">
              {% if image.status == 'completed' %}
              {% with image.get_previous_results|first as latest_result %}
              {% if latest_result %}
              <span class="badge badge-primary">{{ latest_result.label }}</span>
              {% else %}
              <span class="text-sm text-gray-500">-</span>
              {% endif %}
              {% endwith %}
              {% else %}
              <span class="text-sm text-gray-500">-</span>
              {% endif %}
            </td>
            <td>
              {% if image.status == 'completed' %}
              {% with image.get_previous_results|first as latest_result %}
              {% if latest_result %}
              <span class="badge badge-outline">{{ latest_result.confidence }}%</span>
              {% else %}
              <span class="text-sm text-gray-500">-</span>
              {% endif %}
              {% endwith %}
              {% else %}
              <span class="text-sm text-gray-500">-</span>
              {% endif %}
            </td>
            <td>
              {% if image.status == 'failed' %}
              <button type="button" class="btn btn-error btn-sm" aria-haspopup="dialog" aria-expanded="false"
                aria-controls="error-log-modal" data-overlay="#error-log-modal"
                onclick="openErrorModal({{ image.id }})">エラー詳細</button>
              {% else %}
              <span class="text-sm text-gray-500">-</span>
              {% endif %}
            </td>
            <td>
              {% if image.analysis_started_at %}
              {{ image.analysis_started_at|date:"Y-m-d H:i" }}
              {% else %}
              <span class="text-sm text-gray-500">-</span>
              {% endif %}
            </td>
            <td>
              {% if image.analysis_completed_at %}
              {{ image.analysis_completed_at|date:"Y-m-d H:i" }}
              {% else %}
              <span class="text-sm text-gray-500">-</span>
              {% endif %}
            </td>
            <td>
              {% if image.status == 'completed' %}
              {% with image.get_previous_results|first as latest_result %}
              {% if latest_result %}
              {% if latest_result.model_name == 'pytorch_resnet50' %}
              <span class="badge badge-info">PyTorch ResNet-50</span>
              {% elif latest_result.model_name == 'pytorch_vgg16' %}
              <span class="badge badge-info">PyTorch VGG-16</span>
              {% elif latest_result.model_name == 'pytorch_mobilenet' %}
              <span class="badge badge-info">PyTorch MobileNet</span>
              {% elif latest_result.model_name == 'clip' %}
              <span class="badge badge-info">CLIP</span>
              {% else %}
              <span class="badge badge-info">{{ latest_result.model_name }}</span>
              {% endif %}
              {% else %}
              <span class="text-sm text-gray-500">-</span>
              {% endif %}
              {% endwith %}
              {% else %}
              <span class="text-sm text-gray-500">-</span>
              {% endif %}
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <!-- データがない場合の表示 -->
      <div class="text-center py-12">
        <div class="text-base-content/50 text-lg mb-4">
          <span class="icon-[tabler--table-off] size-16 mx-auto block mb-4"></span>
          データがありません
        </div>
        <p class="text-base-content/60">
          画像をアップロードすると、ここに解析結果が表示されます。
        </p>
      </div>
      {% endif %}
    </div>

    <!-- 他の行は省略 -->
  </div>

  <!-- Pagination -->
  <div class="flex flex-wrap items-center justify-between gap-2 py-4">
    <div class="text-sm text-base-content/80">
      {% if has_data %}
      {% if view_all %}
      全 <span class="font-semibold">{{ images|length }}</span>件の画像を表示中
      {% else %}
      <span class="font-semibold">{{ page_obj.start_index }}-{{ page_obj.end_index }}</span>件目 / 全
      <span class="font-semibold">{{ page_obj.paginator.count }}</span>件の画像を表示中
      {% endif %}
      {% else %}
      {% endif %}
    </div>

    <div class="flex items-center gap-2">
      <!-- View All / Paginated Toggle -->
      {% if has_data %}
      {% if view_all %}
      <a href="?" class="btn btn-soft btn-sm">
        <span class="icon-[tabler--layout-grid] size-4"></span>
        ページ分割表示
      </a>
      {% else %}
      <a href="?view_all=true" class="btn btn-soft btn-sm">
        <span class="icon-[tabler--list] size-4"></span>
        全件表示
      </a>
      {% endif %}
      {% endif %}

      <!-- Pagination Navigation -->
      {% if has_data and not view_all and page_obj.has_other_pages %}
      <nav class="join">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-soft btn-square join-item">
          <span class="icon-[tabler--chevron-left] size-5"></span>
        </a>
        {% else %}
        <button class="btn btn-soft btn-square join-item" disabled>
          <span class="icon-[tabler--chevron-left] size-5"></span>
        </button>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
        <button class="btn btn-soft join-item btn-square" aria-current="page">{{ num }}</button>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <a href="?page={{ num }}"
          class="btn btn-soft join-item btn-square">{{ num }}</a>
          {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}" class="btn btn-soft btn-square join-item">
            <span class="icon-[tabler--chevron-right] size-5"></span>
          </a>
          {% else %}
          <button class="btn btn-soft btn-square join-item" disabled>
            <span class="icon-[tabler--chevron-right] size-5"></span>
          </button>
          {% endif %}
      </nav>
      {% endif %}
    </div>
  </div>
</div>



<!-- Image Detail Modal -->
<div id="slide-down-animated-modal" class="overlay modal overlay-open:opacity-100 overlay-open:duration-300 hidden"
  role="dialog" tabindex="-1">
  <div
    class="modal-dialog fixed top-8 left-1/2 transform -translate-x-1/2 overlay-open:duration-300 transition-all ease-out max-w-sm sm:max-w-md lg:max-w-lg">
    <div class="modal-content max-h-[90vh] overflow-y-auto">
      <div class="modal-header">
        <h3 class="modal-title">画像詳細</h3>
        <button type="button" class="btn btn-text btn-circle btn-sm absolute end-3 top-3" aria-label="Close"
          data-overlay="#slide-down-animated-modal">
          <span class="icon-[tabler--x] size-4"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="flex flex-col gap-4">
          <!-- Image -->
          <div class="flex justify-center">
            <img id="modal-image" src="" alt=""
              class="rounded-lg shadow-lg max-w-full h-auto max-h-96 object-contain" />
          </div>

          <!-- Image Details -->
          <div class="grid grid-cols-1 gap-3">
            <div class="flex justify-between items-center">
              <span class="font-semibold">ファイル名:</span>
              <span id="modal-filename" class="text-sm text-gray-600"></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">ユーザー名:</span>
              <span id="modal-username" class="text-sm text-gray-600"></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">アップロード日時:</span>
              <span id="modal-upload-time" class="text-sm text-gray-600"></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">ステータス:</span>
              <span id="modal-status-badge" class="badge badge-outline border-dashed me-2"></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">解析開始日時:</span>
              <span id="modal-analysis-start" class="text-sm text-gray-600"></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">解析終了日時:</span>
              <span id="modal-analysis-end" class="text-sm text-gray-600"></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">使用した学習モデル:</span>
              <span id="modal-model" class="text-sm text-gray-600"></span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">機械学習によってつけられたラベル:</span>
              <div id="modal-labels" class="flex flex-wrap gap-1"></div>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">信頼度:</span>
              <span id="modal-confidence" class="badge"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-soft btn-secondary" data-overlay="#slide-down-animated-modal">
          閉じる
        </button>
      </div>
    </div>
  </div>
</div>

<!-- タイムライン表示モーダル -->
<div id="timeline-modal" class="overlay modal overlay-open:opacity-100 overlay-open:duration-300 hidden" role="dialog"
  tabindex="-1">
  <div
    class="modal-dialog overlay-open:mt-4 sm:overlay-open:mt-8 lg:overlay-open:mt-12 overlay-open:duration-300 transition-all ease-out max-w-sm sm:max-w-md lg:max-w-lg">
    <div class="modal-content">
      <div class="modal-header p-4 sm:p-6">
        <h3 class="modal-title text-lg sm:text-xl">解析タイムライン</h3>
        <button type="button" class="btn btn-text btn-circle btn-sm absolute end-3 top-3" aria-label="Close"
          data-overlay="#timeline-modal">
          <span class="icon-[tabler--x] size-4"></span>
        </button>
      </div>
      <div class="modal-body p-4 sm:p-6">
        <div class="flex flex-col gap-4 sm:gap-6">
          <!-- 画像情報 -->
          <div class="text-center">
            <h4 class="font-semibold text-sm sm:text-base mb-2" id="timeline-filename">ファイル名</h4>
            <p class="text-xs sm:text-sm text-gray-500" id="timeline-status">ステータス</p>
          </div>

          <!-- 進捗バー（解析中の場合のみ表示） -->
          <div id="timeline-progress-section" class="hidden">
            <div class="flex items-center gap-x-3 whitespace-nowrap mb-4">
              <div class="progress h-2 flex-1" id="timeline-progress">
                <div class="progress-bar progress-info transition-all duration-500" style="width:0%"
                  id="timeline-progress-bar"></div>
              </div>
              <span class="text-base-content mb-0.5 text-sm">
                <span id="timeline-progress-value">0</span>%
              </span>
            </div>
            <div class="text-center">
              <span class="text-xs text-gray-600" id="timeline-progress-description">解析中...</span>
            </div>
          </div>

          <!-- タイムライン表示 -->
          <div class="space-y-4" id="timeline-content">
            <div class="flex items-center gap-3">
              <div class="flex-shrink-0">
                <div class="w-8 h-8 bg-success rounded-full flex items-center justify-center">
                  <span class="icon-[tabler--upload] text-success-content size-4"></span>
                </div>
              </div>
              <div class="flex-1">
                <div class="flex justify-between items-center">
                  <span class="text-sm font-medium">ファイルアップロード</span>
                  <span class="text-xs text-gray-500" id="upload-time">-</span>
                </div>
                <div class="text-xs text-gray-600" id="upload-duration">所要時間: -</div>
              </div>
            </div>

            <div class="flex items-center gap-3">
              <div class="flex-shrink-0">
                <div class="w-8 h-8 bg-warning rounded-full flex items-center justify-center">
                  <span class="icon-[tabler--brain] text-warning-content size-4"></span>
                </div>
              </div>
              <div class="flex-1">
                <div class="flex justify-between items-center">
                  <span class="text-sm font-medium">解析開始</span>
                  <span class="text-xs text-gray-500" id="analysis-start-time">-</span>
                </div>
                <div class="text-xs text-gray-600" id="model-used">使用モデル: -</div>
              </div>
            </div>

            <div class="flex items-center gap-3">
              <div class="flex-shrink-0">
                <div class="w-8 h-8 bg-info rounded-full flex items-center justify-center">
                  <span class="icon-[tabler--check] text-info-content size-4"></span>
                </div>
              </div>
              <div class="flex-1">
                <div class="flex justify-between items-center">
                  <span class="text-sm font-medium">解析完了</span>
                  <span class="text-xs text-gray-500" id="analysis-end-time">-</span>
                </div>
                <div class="text-xs text-gray-600" id="analysis-duration">所要時間: -</div>
              </div>
            </div>

            <div class="border-t pt-3">
              <div class="flex justify-between items-center">
                <span class="text-sm font-semibold">総所要時間</span>
                <span class="text-sm font-semibold text-primary" id="total-duration">-</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="flex justify-end gap-3">
          <button type="button" class="btn btn-soft btn-secondary" data-overlay="#timeline-modal">閉じる</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Error Log Modal -->
<div id="error-log-modal" class="overlay modal overlay-open:opacity-100 overlay-open:duration-300 hidden" role="dialog"
  tabindex="-1">
  <div class="modal-dialog overlay-open:mt-12 overlay-open:duration-300 transition-all ease-out">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">エラーログ詳細</h3>
        <button type="button" class="btn btn-text btn-circle btn-sm absolute end-3 top-3" aria-label="Close"
          data-overlay="#error-log-modal">
          <span class="icon-[tabler--x] size-4"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="flex flex-col gap-4">
          <!-- Error Details -->
          <div class="grid grid-cols-1 gap-3">
            <div class="flex justify-between items-center">
              <span class="font-semibold">ファイル名:</span>
              <span class="text-sm text-gray-600" id="error-filename">-</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">ユーザー名:</span>
              <span class="text-sm text-gray-600" id="error-username">-</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">アップロード日時:</span>
              <span class="text-sm text-gray-600" id="error-upload-time">-</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">ステータス:</span>
              <span class="badge badge-outline border-dashed badge-error me-2">失敗</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">エラーログ:</span>
              <div class="text-sm text-gray-600 max-w-xs text-right" id="error-message">
                -
              </div>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-semibold">エラー発生日時:</span>
              <span class="text-sm text-gray-600" id="error-timestamp">-</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-soft btn-secondary" data-overlay="#error-log-modal">
          閉じる
        </button>
      </div>
    </div>
  </div>
</div>

<!-- 解析進捗モーダル -->
<div id="analysis-progress-modal" class="overlay modal overlay-open:opacity-100 overlay-open:duration-300 hidden"
  role="dialog" tabindex="-1">
  <div
    class="modal-dialog overlay-open:mt-4 sm:overlay-open:mt-8 lg:overlay-open:mt-12 overlay-open:duration-300 transition-all ease-out max-w-sm sm:max-w-md lg:max-w-lg">
    <div class="modal-content">
      <div class="modal-header p-4 sm:p-6">
        <h3 class="modal-title text-lg sm:text-xl">解析進捗</h3>
        <button type="button" class="btn btn-text btn-circle btn-sm absolute end-3 top-3" aria-label="Close"
          data-overlay="#analysis-progress-modal">
          <span class="icon-[tabler--x] size-4"></span>
        </button>
      </div>
      <div class="modal-body p-4 sm:p-6">
        <div class="flex flex-col gap-4 sm:gap-6">
          <div class="text-center">
            <p class="text-sm sm:text-base text-gray-600 mb-4">画像解析の進捗状況を表示しています。</p>

            <!-- ローディングアニメーション -->
            <div class="flex justify-center items-center gap-2 mb-4">
              <div class="flex gap-1">
                <span class="w-1.5 h-1.5 bg-info rounded-full animate-pulse"></span>
                <span class="w-1.5 h-1.5 bg-info rounded-full animate-pulse"></span>
                <span class="w-1.5 h-1.5 bg-info rounded-full animate-pulse"></span>
              </div>
            </div>

            <!-- 進捗バー -->
            <div class="flex items-center gap-x-3 whitespace-nowrap mb-4">
              <div class="progress h-2 flex-1" id="timeline-progress">
                <div class="progress-bar progress-info transition-all duration-500" style="width:0%"
                  id="timeline-progress-bar"></div>
              </div>
              <span class="text-base-content mb-0.5 text-sm">
                <span id="timeline-progress-value">0</span>%
              </span>
            </div>
            <div class="text-center">
              <span class="text-xs text-gray-600" id="timeline-progress-description">解析中...</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="flex justify-end gap-3">
          <button type="button" class="btn btn-soft btn-secondary" data-overlay="#analysis-progress-modal">閉じる</button>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_css %}
<style>
  .table tbody tr:nth-child(even) {
    background-color: #f3f4f6;
  }

  .image-placeholder-small {
    background: linear-gradient(135deg, #f3f4f6 25%, transparent 25%),
      linear-gradient(225deg, #f3f4f6 25%, transparent 25%),
      linear-gradient(45deg, #f3f4f6 25%, transparent 25%),
      linear-gradient(315deg, #f3f4f6 25%, transparent 25%);
    background-position: 5px 0, 5px 0, 0 0, 0 0;
    background-size: 10px 10px;
    background-color: #f9fafb;
    width: 100%;
    height: 100%;
    position: relative;
  }

  /* 小さいプレースホルダーが画像読み込み済みの時のスタイル */
  .image-placeholder-small[style*="background-image"],
  .image-placeholder-small.image-loaded {
    background-size: cover !important;
    background-position: center !important;
    background-repeat: no-repeat !important;
  }

  .image-placeholder-small[style*="background-image"] .skeleton,
  .image-placeholder-small.image-loaded .skeleton {
    display: none !important;
  }
</style>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/pages/admin-table.js' %}"></script>
{% endblock %}
