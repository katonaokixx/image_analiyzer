{% extends 'auth_base.html' %}
{% load static %}

{% block title %}サインアップ - 画像解析アプリ{% endblock %}
{% block content %}
<div class="flex h-auto min-h-screen items-center justify-center overflow-x-hidden py-2">
  <div class="relative flex items-center justify-center px-4 sm:px-6 lg:px-8">
    <div class="bg-base-100 shadow-base-300/20 z-1 w-full space-y-6 rounded-xl p-6 shadow-md sm:min-w-md lg:p-8">
      <div class="flex items-center gap-3">
        <h2 class="text-base-content text-xl font-bold">画像解析アプリ</h2>
      </div>
      <div>
        <h3 class="text-base-content mb-1.5 text-2xl font-semibold">Sign Up to 画像解析アプリ</h3>
      </div>
      <div class="space-y-4">
        <form class="mb-4 space-y-4" method="post">
          {% csrf_token %}
          <div>
            <label class="label-text" for="userName">Username*</label>
            <div class="max-w-sm">
              <div class="flex mb-2">
                <div class="flex-1">
                  <input type="text" placeholder="Enter your username" class="input" id="userName" name="username"
                    required pattern="[a-zA-Z0-9_ () \u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]{2,20}"
                    title="2-20文字の英数字、ひらがな、カタカナ、漢字、アンダースコア、半角スペース、半角括弧" />
                  <div class="rounded-full overflow-hidden mt-2 flex gap-0.5 h-1.5 bg-neutral/20">
                    <div id="username-strength-bar" class="h-full w-full transition-all duration-300"
                      style="background-color: #d1d5db;"></div>
                  </div>
                </div>
              </div>
              <div id="username-hints-content" class="mb-3">
                <h6 class="my-2 text-base font-semibold text-base-content">ユーザー名の要件:</h6>
                <ul class="text-base-content/80 space-y-1 text-sm">
                  <li data-pw-strength-rule="min-length" class="flex items-center gap-x-2" style="color: #6b7280;">
                    <span class="icon-[tabler--circle-check] hidden size-5 shrink-0" data-check></span>
                    <span class="icon-[tabler--circle-x] size-5 shrink-0" data-uncheck></span>
                    長さ: 2-20文字
                  </li>
                  <li data-pw-strength-rule="lowercase" class="flex items-center gap-x-2" style="color: #6b7280;">
                    <span class="icon-[tabler--circle-check] hidden size-5 shrink-0" data-check></span>
                    <span class="icon-[tabler--circle-x] size-5 shrink-0" data-uncheck></span>
                    英数字、ひらがな、カタカナ、漢字、アンダースコア、半角スペース、半角括弧のみ使用可能
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div>
            <label class="label-text" for="userEmail">Email address*</label>
            <div class="max-w-sm">
              <div class="flex mb-2">
                <div class="flex-1">
                  <input type="email" placeholder="Enter your email address" class="input" id="userEmail" name="email"
                    required />
                  <div class="rounded-full overflow-hidden mt-2 flex gap-0.5 h-1.5 bg-neutral/20">
                    <div id="email-strength-bar" class="h-full w-full transition-all duration-300"
                      style="background-color: #d1d5db;"></div>
                  </div>
                </div>
              </div>
              <div id="email-hints-content" class="mb-3">
                <h6 class="my-2 text-base font-semibold text-base-content">メールアドレスの要件:</h6>
                <ul class="text-base-content/80 space-y-1 text-sm">
                  <li data-pw-strength-rule="min-length" class="flex items-center gap-x-2" style="color: #6b7280;">
                    <span class="icon-[tabler--circle-check] hidden size-5 shrink-0" data-check></span>
                    <span class="icon-[tabler--circle-x] size-5 shrink-0" data-uncheck></span>
                    有効なメール形式（user@domain.com）
                  </li>
                  <li data-pw-strength-rule="lowercase" class="flex items-center gap-x-2" style="color: #6b7280;">
                    <span class="icon-[tabler--circle-check] hidden size-5 shrink-0" data-check></span>
                    <span class="icon-[tabler--circle-x] size-5 shrink-0" data-uncheck></span>
                    @記号とドメインを含む必要があります
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div>
            <label class="label-text" for="userPassword">Password*</label>
            <div class="max-w-sm">
              <div class="flex mb-2">
                <div class="flex-1">
                  <div class="input max-w-sm">
                    <input id="toggle-password" type="password" placeholder="Enter password" name="password" required />
                    <button type="button" data-toggle-password='{ "target": "#toggle-password" }'
                      class="block cursor-pointer" aria-label="password toggle">
                      <span
                        class="icon-[tabler--eye] text-base-content/80 password-active:block hidden size-5 shrink-0"></span>
                      <span
                        class="icon-[tabler--eye-off] text-base-content/80 password-active:hidden block size-5 shrink-0"></span>
                    </button>
                  </div>
                  <div class="rounded-full overflow-hidden mt-2 flex gap-0.5 h-1.5 bg-neutral/20">
                    <div id="password-strength-bar" class="h-full w-full transition-all duration-300"
                      style="background-color: #d1d5db;"></div>
                  </div>
                </div>
              </div>
              <div id="password-hints-content" class="mb-3">
                <h6 class="my-2 text-base font-semibold text-base-content">パスワードの要件:</h6>
                <ul class="text-base-content/80 space-y-1 text-sm">
                  <li data-pw-strength-rule="min-length" class="flex items-center gap-x-2" style="color: #6b7280;">
                    <span class="icon-[tabler--circle-check] hidden size-5 shrink-0" data-check></span>
                    <span class="icon-[tabler--circle-x] size-5 shrink-0" data-uncheck></span>
                    最小6文字以上
                  </li>
                  <li data-pw-strength-rule="lowercase" class="flex items-center gap-x-2" style="color: #6b7280;">
                    <span class="icon-[tabler--circle-check] hidden size-5 shrink-0" data-check></span>
                    <span class="icon-[tabler--circle-x] size-5 shrink-0" data-uncheck></span>
                    小文字を含む
                  </li>
                  <li data-pw-strength-rule="uppercase" class="flex items-center gap-x-2" style="color: #6b7280;">
                    <span class="icon-[tabler--circle-check] hidden size-5 shrink-0" data-check></span>
                    <span class="icon-[tabler--circle-x] size-5 shrink-0" data-uncheck></span>
                    大文字を含む
                  </li>
                  <li data-pw-strength-rule="numbers" class="flex items-center gap-x-2" style="color: #6b7280;">
                    <span class="icon-[tabler--circle-check] hidden size-5 shrink-0" data-check></span>
                    <span class="icon-[tabler--circle-x] size-5 shrink-0" data-uncheck></span>
                    数字を含む
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div>
            <label class="label-text" for="userConfrimPassword">Confirm Password*</label>
            <div class="max-w-sm">
              <div class="flex mb-2">
                <div class="flex-1">
                  <div class="input">
                    <input id="userConfrimPassword" type="password" placeholder="············" name="confirm_password"
                      required />
                    <button type="button" data-toggle-password='{ "target": "#userConfrimPassword" }'
                      class="block cursor-pointer" aria-label="userConfrimPassword">
                      <span class="icon-[tabler--eye] password-active:block hidden size-5 shrink-0"></span>
                      <span class="icon-[tabler--eye-off] password-active:hidden block size-5 shrink-0"></span>
                    </button>
                  </div>
                  <div class="rounded-full overflow-hidden mt-2 flex gap-0.5 h-1.5 bg-neutral/20">
                    <div id="confirm-password-strength-bar" class="h-full w-full transition-all duration-300"
                      style="background-color: #d1d5db;"></div>
                  </div>
                </div>
              </div>
              <div id="confirm-password-hints-content" class="mb-3">
                <h6 class="my-2 text-base font-semibold text-base-content">確認パスワードの要件:</h6>
                <ul class="text-base-content/80 space-y-1 text-sm">
                  <li data-pw-strength-rule="min-length" class="flex items-center gap-x-2" style="color: #6b7280;">
                    <span class="icon-[tabler--circle-check] hidden size-5 shrink-0" data-check></span>
                    <span class="icon-[tabler--circle-x] size-5 shrink-0" data-uncheck></span>
                    パスワードと一致
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <input type="checkbox" class="checkbox checkbox-primary" id="policyagreement" name="is_admin" />
            <label class="label-text text-base-content/80 p-0 text-base" for="policyagreement">
              管理者として登録します
            </label>
          </div>
          <button type="submit" class="btn btn-lg btn-primary btn-gradient btn-block">アカウント作成</button>
        </form>
        <p class="text-base-content/80 mb-4 text-center">
          既にアカウントはお持ちですか?
          <a href="{% url 'v2_login' %}" class="link link-animated link-primary font-normal">ログイン画面</a>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- アカウント作成成功モーダル -->
<div id="signup-success-modal" class="overlay modal hidden" role="dialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">アカウント作成完了</h3>
        <button type="button" class="btn btn-text btn-circle btn-sm absolute end-3 top-3" aria-label="Close"
          data-overlay="#signup-success-modal">
          <span class="icon-[tabler--x] size-4"></span>
        </button>
      </div>
      <div class="modal-body pb-6 text-center">
        <div class="mb-4">
          <span class="icon-[tabler--circle-check] size-16 text-success mx-auto block"></span>
        </div>
        <p class="text-lg mb-2">アカウントが正常に作成されました！</p>
        <p class="text-sm text-base-content/70 mb-4">5秒後にログイン画面に自動で移動します。</p>
        <a href="{% url 'v2_login' %}" class="btn btn-primary">今すぐログイン画面へ</a>
      </div>
    </div>
  </div>
</div>

<!-- 重複エラーモーダル -->
<div id="signup-duplicate-modal" class="overlay modal hidden" role="dialog" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">アカウント作成エラー</h3>
        <button type="button" class="btn btn-text btn-circle btn-sm absolute end-3 top-3" aria-label="Close"
          data-overlay="#signup-duplicate-modal">
          <span class="icon-[tabler--x] size-4"></span>
        </button>
      </div>
      <div class="modal-body pb-6 text-center">
        <div class="mb-4">
          <span class="icon-[tabler--circle-x] size-16 text-error mx-auto block"></span>
        </div>
        <p class="text-lg mb-2">既に同じ名前、メールアドレスのアカウントがあります。</p>
        <p class="text-sm text-base-content/70 mb-4">5秒後にログイン画面に自動で移動します。</p>
        <a href="{% url 'v2_login' %}" class="btn btn-primary">今すぐログイン画面へ</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
{% block extra_js %}
<script src="{% static 'js/pages/signup-validation.js' %}"></script>
{% endblock %}
