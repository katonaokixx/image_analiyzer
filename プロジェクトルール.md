# 画像解析アプリ プロジェクトルール（詳細版）

## 🚫 絶対に守るべきルール

### 1. コード記述に関する制約

* **勝手にコードは書かない**

  * ユーザー（発注者・管理者）の明示的な依頼があるまで、開発者はコードを書いてはいけない。
  * 「推測による機能追加」「勝手なリファクタリング」などは厳禁。
* **ターミナル作業も勝手に行わない**

  * コマンドの実行は、ユーザーの明示的な承認を得てから行う。
  * システム設定変更やパッケージインストールなども事前承認必須。
* **ユーザーの作業完了確認必須**

  * 「更新した」「やった」「追記した」「修正した」などのメッセージを受信した場合、指示した内容が適切に対応されているか該当ファイルをチェックする。
  * 確認が完了するまで次の作業に進まない。
* **JavaScriptファイル操作の制約**

  * JavaScriptファイルの操作、編集、移動を行う際は、基本的に既存のHTMLファイルに記述されているコードを使用すること。
  * 既存のコードを勝手に変更・追加せず、そのまま抽出・移動する。
  * 新機能の追加は、ユーザーの明示的な指示があるまで行わない。
* **Tailwind CSS v4 + FlyonUI設定の重要事項**

  * **input.css**: ビルド設定ファイル（@import "tailwindcss", @plugin "flyonui"等）
  * **output.css**: ビルド済み完成版CSS（ブラウザで読み込むファイル）
  * **ブラウザ表示**: output.cssのみ読み込めば十分、input.cssは不要
  * **ビルドプロセス**: npm run watch:cssで自動ビルド中（既に動作中）
  * **注意**: input.cssを削除するとビルドが失敗する、必ず保持すること
* **フロントエンドUIの変更禁止**

  * 各 `.html` ファイル（`index.html`, `admin_image_table.html`, など）のUIは固定仕様。
  * TailwindクラスやFlyonUIのコンポーネントを勝手に差し替えない。
* **ユーザー指示優先**

  * 既存のUIや設計方針を変更する場合は、必ずユーザーの承認を得る。

### 2. バックエンドコードの品質

* **スパゲッティコード禁止**

  * 条件分岐や処理を一箇所に詰め込むのではなく、関数やクラスへ適切に分離。
* **可読性向上**

  * 1ファイルに役割を詰め込みすぎない。責任の分離を徹底。
  * 「誰が見ても理解できるコード」を基準に記述。
* **保守性重視**

  * 将来的に「モデル追加」「画像フォーマット拡張」などが想定されるため、柔軟な設計を行う。
  * バリデーションや解析処理は再利用可能な仕組みにまとめる。

---

## 📋 プロジェクト概要

### 目的

ユーザーがアップロードした画像を、機械学習モデルによって解析し、分類ラベルや信頼度を提示することで「わかりやすく結果を確認できる」Webアプリケーションを構築する。

### 機能概要

* **画像アップロード**: 画像ファイルをサーバーに送信し、DBに保存。
* **AI解析**: 事前学習済みモデルを用いてラベル分類。複数モデルを切替可能。
* **結果表示**: ラベル・信頼度・解析履歴をユーザー画面に表示。
* **ユーザー管理**: 一般ユーザーと管理者でアクセス権限を分離。
* **進捗管理**: 「準備中 → 解析中 → 成功/失敗」といったリアルタイム進捗を可視化。

### 技術スタック

* **フロントエンド**: HTML + Tailwind CSS + FlyonUI + JavaScript
* **バックエンド**: Django (Python 3.12系)
* **データベース**: PostgreSQL
* **AI/ML**: ResNet, EfficientNet, MobileNet, VGG, カスタムモデル

### 対象ユーザー

* **一般ユーザー**: 自身のアップロード画像の解析結果を確認する人
* **管理者**: 全ユーザーの状況を一覧し、システムの稼働状況やエラーを監視する人

---

## 🗂️ 各ページの概要

### 1. `index.html` - 一般ユーザー向け画像一覧

* **目的**: 自分の解析結果を一覧で閲覧
* **機能**:

  * アップロード済み画像一覧表示
  * ステータスフィルタリング（成功/失敗/解析中など）
  * 画像詳細をモーダルで確認（ラベル・信頼度）
* **表示項目**: ファイル名 / アップロード日時 / ステータス / MLラベル / 信頼度

### 2. `admin_image_table.html` - 管理者向け画像一覧

* **目的**: 全ユーザーの解析状況を監視
* **機能**:

  * ユーザー単位のフィルタリング
  * 解析ログの確認
  * モデルごとの処理状況可視化
* **表示項目**: ユーザー名 / ファイル名 / アップロード日時 / ステータス / エラーログ / 解析開始/終了日時 / 使用モデル

### 3. `image.upload.html` - 画像アップロード

* **目的**: 解析開始の入口
* **機能**: ファイル選択 / モデル選択 / 解析開始ボタン
* **制限**:

  * 1回あたり最大5枚
  * 1枚あたり最大1MB
  * 合計最大5MB

### 4. `login.html` - ログイン画面

* **機能**: ユーザー名・パスワード入力、ログイン処理

### 5. `signup.html` - 新規ユーザー登録

* **機能**: ユーザー名・メール・パスワードを入力し、DBに保存

### 6. `password_reset.html` - パスワードリセット

* **機能**: メールアドレスを入力 → リセットメール送信

---

## ✅ バリデーションルール

### 1. 画像アップロード

* 枚数: 最大5枚
* ファイル形式: JPG, PNG, GIF
* サイズ: 1枚 最大1MB、合計最大5MB
* 必須: ファイル選択 + ユーザーID

### 2. ユーザー情報

* **ユーザー名**: 3〜20文字。記号のみ禁止。
* **メール**: `@` を含む有効形式。
* **パスワード**:

  * 8文字以上
  * 大文字・小文字・数字・特殊文字を1種類以上含む
  * 確認用と一致必須

### 3. 解析設定

* モデル選択必須。候補:

  * ResNet-50 v2.1
  * EfficientNet-B0
  * MobileNet v2
  * VGG-16
  * カスタムモデル

---

## 🗄️ データベース設計

（DDLは既存通り。補足として「制約・インデックス」情報を追加）

* **users**

  * `username, email` はUNIQUE制約
  * `is_admin` で権限判定

* **images**

  * `status` 値: `準備中 / 解析中 / 解析成功 / 失敗`
  * `model_used` にモデル名保存
  * `error_log` で失敗時の内容保持

* **analysis\_results**

  * 1画像に対して複数ラベル保存可能
  * `confidence` は0.00〜100.00%

---

## 🔧 開発ガイドライン

### 1. コード品質

* DRY（Don't Repeat Yourself）原則を徹底
* 単一責任原則（関数は一つの責任のみ）
* 分かりやすい命名規則（snake\_case, PascalCaseを使い分け）
* 処理が複雑な箇所にはコメント必須

### 2. Django開発

* MVTパターンを厳守
* フォームは必ず Django Forms を利用（独自バリデーションはFormに集約）
* 認証は Django 標準 `django.contrib.auth` を利用
* セキュリティ:

  * CSRF対策
  * SQLインジェクション防止（ORM使用）
  * XSS対策（テンプレートエスケープ）

### 3. データベース設計

* 第3正規形を基本とする
* パフォーマンスが必要な項目（`user_id`, `status`）にはインデックス付与
* 外部キー制約を明示し、孤立データを防ぐ

---

## 📝 今後の実装予定

### Phase 1（基本機能）

* ユーザー登録・認証
* 画像アップロード
* 一覧表示

### Phase 2（解析機能）

* 解析APIとの連携
* 結果保存・表示
* 進捗ステータス更新

### Phase 3（管理機能）

* 管理者向けダッシュボード
* エラーログ監視
* パフォーマンス最適化

---

## ⚠️ 注意事項

* UI変更は厳禁
* コード記述はユーザー指示があるまで行わない
* バックエンドは保守性・セキュリティ重視
* 既存機能を壊さないこと

---

## 📞 開発者向けメッセージ

このプロジェクトは「ユーザー指示に基づく段階的開発」が前提です。
小さな変更であっても必ず報告 → 承認を経てから反映してください。
レビューとテストを並行し、品質を維持することを最優先にしてください。

---

**最終更新**: 2025年8月29日
**作成者**: AI Assistant
**承認**: ユーザー
